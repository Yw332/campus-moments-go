# 修复 .env 文件编码问题
Write-Host "🔧 修复 .env 文件编码..." -ForegroundColor Yellow

# 读取原始文件（二进制方式）
 = "F:\campus-moments-go\.env"
80 79 82 84 61 51 48 48 48 10 65 80 80 95 69 78 86 61 112 114 111 100 117 99 116 105 111 110 10 71 73 78 95 77 79 68 69 61 114 101 108 101 97 115 101 10 10 68 66 95 72 79 83 84 61 49 48 54 46 53 50 46 49 54 53 46 49 50 50 10 68 66 95 80 79 82 84 61 51 51 48 54 10 68 66 95 78 65 77 69 61 99 97 109 112 117 115 95 109 111 109 101 110 116 115 10 68 66 95 85 83 69 82 61 119 111 114 107 98 101 110 99 104 95 117 115 101 114 10 68 66 95 80 65 83 83 87 79 82 68 61 114 117 97 110 103 111 110 103 55 10 10 74 87 84 95 83 69 67 82 69 84 61 112 114 111 100 117 99 116 105 111 110 45 99 111 109 112 108 101 120 45 115 101 99 114 101 116 45 107 101 121 45 51 50 45 99 104 97 114 115 45 109 105 110 105 109 117 109 10 74 87 84 95 69 88 80 73 82 69 95 72 79 85 82 83 61 49 54 56 10 10 65 80 80 95 78 65 77 69 61 67 97 109 112 117 115 95 77 111 109 101 110 116 115 95 71 111 95 65 80 73 10 65 80 80 95 86 69 82 83 73 79 78 61 49 46 48 46 48 = [System.IO.File]::ReadAllBytes()

# 检查是否有BOM (EF BB BF = 239 187 191)
if (80 79 82 84 61 51 48 48 48 10 65 80 80 95 69 78 86 61 112 114 111 100 117 99 116 105 111 110 10 71 73 78 95 77 79 68 69 61 114 101 108 101 97 115 101 10 10 68 66 95 72 79 83 84 61 49 48 54 46 53 50 46 49 54 53 46 49 50 50 10 68 66 95 80 79 82 84 61 51 51 48 54 10 68 66 95 78 65 77 69 61 99 97 109 112 117 115 95 109 111 109 101 110 116 115 10 68 66 95 85 83 69 82 61 119 111 114 107 98 101 110 99 104 95 117 115 101 114 10 68 66 95 80 65 83 83 87 79 82 68 61 114 117 97 110 103 111 110 103 55 10 10 74 87 84 95 83 69 67 82 69 84 61 112 114 111 100 117 99 116 105 111 110 45 99 111 109 112 108 101 120 45 115 101 99 114 101 116 45 107 101 121 45 51 50 45 99 104 97 114 115 45 109 105 110 105 109 117 109 10 74 87 84 95 69 88 80 73 82 69 95 72 79 85 82 83 61 49 54 56 10 10 65 80 80 95 78 65 77 69 61 67 97 109 112 117 115 95 77 111 109 101 110 116 115 95 71 111 95 65 80 73 10 65 80 80 95 86 69 82 83 73 79 78 61 49 46 48 46 48[0] -eq 239 -and 80 79 82 84 61 51 48 48 48 10 65 80 80 95 69 78 86 61 112 114 111 100 117 99 116 105 111 110 10 71 73 78 95 77 79 68 69 61 114 101 108 101 97 115 101 10 10 68 66 95 72 79 83 84 61 49 48 54 46 53 50 46 49 54 53 46 49 50 50 10 68 66 95 80 79 82 84 61 51 51 48 54 10 68 66 95 78 65 77 69 61 99 97 109 112 117 115 95 109 111 109 101 110 116 115 10 68 66 95 85 83 69 82 61 119 111 114 107 98 101 110 99 104 95 117 115 101 114 10 68 66 95 80 65 83 83 87 79 82 68 61 114 117 97 110 103 111 110 103 55 10 10 74 87 84 95 83 69 67 82 69 84 61 112 114 111 100 117 99 116 105 111 110 45 99 111 109 112 108 101 120 45 115 101 99 114 101 116 45 107 101 121 45 51 50 45 99 104 97 114 115 45 109 105 110 105 109 117 109 10 74 87 84 95 69 88 80 73 82 69 95 72 79 85 82 83 61 49 54 56 10 10 65 80 80 95 78 65 77 69 61 67 97 109 112 117 115 95 77 111 109 101 110 116 115 95 71 111 95 65 80 73 10 65 80 80 95 86 69 82 83 73 79 78 61 49 46 48 46 48[1] -eq 187 -and 80 79 82 84 61 51 48 48 48 10 65 80 80 95 69 78 86 61 112 114 111 100 117 99 116 105 111 110 10 71 73 78 95 77 79 68 69 61 114 101 108 101 97 115 101 10 10 68 66 95 72 79 83 84 61 49 48 54 46 53 50 46 49 54 53 46 49 50 50 10 68 66 95 80 79 82 84 61 51 51 48 54 10 68 66 95 78 65 77 69 61 99 97 109 112 117 115 95 109 111 109 101 110 116 115 10 68 66 95 85 83 69 82 61 119 111 114 107 98 101 110 99 104 95 117 115 101 114 10 68 66 95 80 65 83 83 87 79 82 68 61 114 117 97 110 103 111 110 103 55 10 10 74 87 84 95 83 69 67 82 69 84 61 112 114 111 100 117 99 116 105 111 110 45 99 111 109 112 108 101 120 45 115 101 99 114 101 116 45 107 101 121 45 51 50 45 99 104 97 114 115 45 109 105 110 105 109 117 109 10 74 87 84 95 69 88 80 73 82 69 95 72 79 85 82 83 61 49 54 56 10 10 65 80 80 95 78 65 77 69 61 67 97 109 112 117 115 95 77 111 109 101 110 116 115 95 71 111 95 65 80 73 10 65 80 80 95 86 69 82 83 73 79 78 61 49 46 48 46 48[2] -eq 191) {
    Write-Host "❌ 检测到UTF-8 BOM头" -ForegroundColor Red
    
    # 移除BOM头（跳过前3个字节）
     = [System.Text.Encoding]::UTF8.GetString(80 79 82 84 61 51 48 48 48 10 65 80 80 95 69 78 86 61 112 114 111 100 117 99 116 105 111 110 10 71 73 78 95 77 79 68 69 61 114 101 108 101 97 115 101 10 10 68 66 95 72 79 83 84 61 49 48 54 46 53 50 46 49 54 53 46 49 50 50 10 68 66 95 80 79 82 84 61 51 51 48 54 10 68 66 95 78 65 77 69 61 99 97 109 112 117 115 95 109 111 109 101 110 116 115 10 68 66 95 85 83 69 82 61 119 111 114 107 98 101 110 99 104 95 117 115 101 114 10 68 66 95 80 65 83 83 87 79 82 68 61 114 117 97 110 103 111 110 103 55 10 10 74 87 84 95 83 69 67 82 69 84 61 112 114 111 100 117 99 116 105 111 110 45 99 111 109 112 108 101 120 45 115 101 99 114 101 116 45 107 101 121 45 51 50 45 99 104 97 114 115 45 109 105 110 105 109 117 109 10 74 87 84 95 69 88 80 73 82 69 95 72 79 85 82 83 61 49 54 56 10 10 65 80 80 95 78 65 77 69 61 67 97 109 112 117 115 95 77 111 109 101 110 116 115 95 71 111 95 65 80 73 10 65 80 80 95 86 69 82 83 73 79 78 61 49 46 48 46 48, 3, 80 79 82 84 61 51 48 48 48 10 65 80 80 95 69 78 86 61 112 114 111 100 117 99 116 105 111 110 10 71 73 78 95 77 79 68 69 61 114 101 108 101 97 115 101 10 10 68 66 95 72 79 83 84 61 49 48 54 46 53 50 46 49 54 53 46 49 50 50 10 68 66 95 80 79 82 84 61 51 51 48 54 10 68 66 95 78 65 77 69 61 99 97 109 112 117 115 95 109 111 109 101 110 116 115 10 68 66 95 85 83 69 82 61 119 111 114 107 98 101 110 99 104 95 117 115 101 114 10 68 66 95 80 65 83 83 87 79 82 68 61 114 117 97 110 103 111 110 103 55 10 10 74 87 84 95 83 69 67 82 69 84 61 112 114 111 100 117 99 116 105 111 110 45 99 111 109 112 108 101 120 45 115 101 99 114 101 116 45 107 101 121 45 51 50 45 99 104 97 114 115 45 109 105 110 105 109 117 109 10 74 87 84 95 69 88 80 73 82 69 95 72 79 85 82 83 61 49 54 56 10 10 65 80 80 95 78 65 77 69 61 67 97 109 112 117 115 95 77 111 109 101 110 116 115 95 71 111 95 65 80 73 10 65 80 80 95 86 69 82 83 73 79 78 61 49 46 48 46 48.Length - 3)
    
    # 用ASCII编码重新保存（确保没有BOM）
    [System.IO.File]::WriteAllText(, , [System.Text.Encoding]::ASCII)
    
    Write-Host "✅ 已移除BOM头" -ForegroundColor Green
} else {
    Write-Host "✅ 文件无BOM头" -ForegroundColor Green
}

# 检查是否有非法字符
 = Get-Content  -Raw
if ( -match '[^\x00-\x7F]') {
    Write-Host "⚠️  检测到非ASCII字符" -ForegroundColor Yellow
    
    # 移除所有非ASCII字符
     =  -replace '[^\x00-\x7F]', ''
    [System.IO.File]::WriteAllText(, , [System.Text.Encoding]::ASCII)
    
    Write-Host "✅ 已清理非ASCII字符" -ForegroundColor Green
}

Write-Host "
清理后的文件内容:" -ForegroundColor Cyan
Get-Content 
