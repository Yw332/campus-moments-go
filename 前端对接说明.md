# å‰ç«¯å¯¹æ¥è¯´æ˜æ–‡æ¡£

## ğŸŒ APIæœåŠ¡å™¨ä¿¡æ¯

**æœåŠ¡å™¨åœ°å€**: `http://106.52.165.122:8080`

**å¥åº·æ£€æŸ¥**: `GET http://106.52.165.122:8080/health`

## ğŸ“‹ ä¸»è¦æ¥å£åˆ—è¡¨

### ğŸ” ç”¨æˆ·è®¤è¯
- `POST /auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/logout` - é€€å‡ºç™»å½•
- `GET /api/users/profile` - è·å–ç”¨æˆ·èµ„æ–™
- `PUT /api/users/password` - ä¿®æ”¹å¯†ç 

### ğŸ“„ åŠ¨æ€ç›¸å…³
- `GET /moments` - è·å–åŠ¨æ€åˆ—è¡¨ï¼ˆå…¬å¼€ï¼‰
- `POST /api/moments` - å‘å¸ƒåŠ¨æ€
- `GET /api/moments/:id` - è·å–åŠ¨æ€è¯¦æƒ…
- `PATCH /api/moments/:id` - ç¼–è¾‘åŠ¨æ€
- `DELETE /api/moments/:id` - åˆ é™¤åŠ¨æ€

### ğŸ“¤ æ–‡ä»¶ä¸Šä¼ 
- `POST /api/upload/file` - é€šç”¨æ–‡ä»¶ä¸Šä¼ 
- `POST /api/upload/avatar` - å¤´åƒä¸Šä¼ 

#### ğŸ“¸ å¤´åƒä¸Šä¼ æ¥å£è¯¦æƒ…

**æ¥å£åœ°å€**: `POST http://106.52.165.122:8080/api/upload/avatar`

**è¯·æ±‚æ–¹å¼**: `multipart/form-data`

**è¯·æ±‚å‚æ•°**:
```
avatar: File (å¿…éœ€) - å¤´åƒæ–‡ä»¶
```

**æ–‡ä»¶è¦æ±‚**:
- æ”¯æŒæ ¼å¼: jpg, jpeg, png, gif, webp
- æ–‡ä»¶å¤§å°: æœ€å¤§ 5MB
- æ¨èå°ºå¯¸: æ­£æ–¹å½¢ (å¦‚ 200x200px)

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "å¤´åƒä¸Šä¼ æˆåŠŸ",
  "data": {
    "avatarUrl": "http://106.52.165.122:8080/uploads/avatars/1_20231214150000_uuid.jpg",
    "userId": 1
  }
}
```

**JavaScript ç¤ºä¾‹**:
```javascript
// ä¸Šä¼ å¤´åƒ
async function uploadAvatar(file) {
  const formData = new FormData();
  formData.append('avatar', file);

  const response = await fetch('http://106.52.165.122:8080/api/upload/avatar', {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    },
    body: formData
  });

  const result = await response.json();
  if (result.code === 200) {
    console.log('å¤´åƒä¸Šä¼ æˆåŠŸ:', result.data.avatarUrl);
    // æ›´æ–°ç”¨æˆ·å¤´åƒæ˜¾ç¤º
  }
}

// è·å–ç”¨æˆ·èµ„æ–™ï¼ˆåŒ…å«å¤´åƒä¿¡æ¯ï¼‰
async function getUserProfile() {
  const response = await fetch('http://106.52.165.122:8080/api/users/profile', {
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });

  const result = await response.json();
  if (result.code === 200) {
    console.log('ç”¨æˆ·ä¿¡æ¯:', result.data);
    // result.data.avatar åŒ…å«å¤´åƒURL
  }
}
```

### ğŸ” æœç´¢åŠŸèƒ½
- `GET /api/search` - æœç´¢å†…å®¹
- `GET /api/search/hot-words` - çƒ­é—¨å…³é”®è¯
- `GET /api/search/history` - æœç´¢å†å²

## ğŸ”‘ è®¤è¯æ–¹å¼

æ‰€æœ‰ `/api/*` å¼€å¤´çš„æ¥å£éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦JWT Tokenï¼š

```javascript
headers: {
  'Content-Type': 'application/json',
  'Authorization': 'Bearer <your_token_here>'
}
```

## ğŸ“± æµ‹è¯•è´¦å·

| ç”¨æˆ·å | æ‰‹æœºå· | å¯†ç  |
|--------|--------|------|
| Yw166332 | 17875242005 | JiangCan030 |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æµ‹è¯•æœåŠ¡å™¨è¿æ¥
```javascript
fetch('http://106.52.165.122:8080/health')
  .then(res => res.json())
  .then(data => console.log(data));
```

### 2. ç”¨æˆ·ç™»å½•ç¤ºä¾‹
```javascript
const login = async (username, password) => {
  const response = await fetch('http://106.52.165.122:8080/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ account: username, password })
  });
  
  const result = await response.json();
  if (result.code === 200) {
    // ä¿å­˜token
    localStorage.setItem('token', result.data.token);
    localStorage.setItem('userInfo', JSON.stringify(result.data.userInfo));
  }
  return result;
};
```

### 3. è·å–åŠ¨æ€åˆ—è¡¨ç¤ºä¾‹
```javascript
const getMoments = async () => {
  const response = await fetch('http://106.52.165.122:8080/moments');
  return await response.json();
};
```

### 4. éœ€è¦è®¤è¯çš„è¯·æ±‚ç¤ºä¾‹
```javascript
const authRequest = async (url, options = {}) => {
  const token = localStorage.getItem('token');
  
  const response = await fetch(`http://106.52.165.122:8080${url}`, {
    ...options,
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`,
      ...options.headers
    }
  });
  
  return await response.json();
};

// è·å–ç”¨æˆ·èµ„æ–™
const userProfile = await authRequest('/api/users/profile');
```

## ğŸ“¨ å“åº”æ ¼å¼

æ‰€æœ‰æ¥å£éƒ½è¿”å›ç»Ÿä¸€çš„JSONæ ¼å¼ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {}
}
```

**çŠ¶æ€ç è¯´æ˜**:
- `200` - æˆåŠŸ
- `400` - è¯·æ±‚å‚æ•°é”™è¯¯
- `401` - æœªè®¤è¯æˆ–è®¤è¯å¤±è´¥
- `404` - èµ„æºä¸å­˜åœ¨
- `500` - æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **Tokenæœ‰æ•ˆæœŸ**: 7å¤© (168å°æ—¶)
2. **é€šç”¨æ–‡ä»¶ä¸Šä¼ **: å›¾ç‰‡æ ¼å¼é™åˆ¶ä¸º `jpg`, `jpeg`, `png`, `gif`ï¼Œæœ€å¤§10MB
3. **å¤´åƒä¸Šä¼ **: å›¾ç‰‡æ ¼å¼é™åˆ¶ä¸º `jpg`, `jpeg`, `png`, `gif`, `webp`ï¼Œæœ€å¤§5MB
4. **è·¨åŸŸ**: å·²é…ç½®å…è®¸å‰ç«¯è®¿é—®
5. **æ•°æ®åº“**: è¿æ¥åˆ°æœåŠ¡å™¨MySQLï¼Œæ•°æ®æŒä¹…åŒ–
6. **å¤´åƒå­˜å‚¨**: ä¸Šä¼ çš„å¤´åƒä¼šè‡ªåŠ¨å…³è”åˆ°ç”¨æˆ·è´¦æˆ·ï¼Œåœ¨ç”¨æˆ·èµ„æ–™ä¸­å¯è§

## ğŸ› å¸¸è§é—®é¢˜

### Q: æç¤º"missing authorization header"
A: è¯·åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  `Authorization: Bearer <token>`

### Q: Tokenè¿‡æœŸäº†æ€ä¹ˆåŠ
A: éœ€è¦é‡æ–°ç™»å½•è·å–æ–°token

### Q: æ–‡ä»¶ä¸Šä¼ å¤±è´¥
A: æ£€æŸ¥æ–‡ä»¶æ ¼å¼å’Œå¤§å°æ˜¯å¦ç¬¦åˆè¦æ±‚

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜è¯·è”ç³»åç«¯å¼€å‘è€…æˆ–æŸ¥çœ‹å®Œæ•´APIæ–‡æ¡£ï¼š`API_AUTH_DOCS.md`