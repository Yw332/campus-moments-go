# ğŸ“¸ å¤´åƒä¸Šä¼ åŠŸèƒ½è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

å¤´åƒä¸Šä¼ åŠŸèƒ½å…è®¸ç”¨æˆ·ä¸Šä¼ ä¸ªäººå¤´åƒå›¾ç‰‡ï¼Œå¤´åƒä¼šè‡ªåŠ¨å…³è”åˆ°ç”¨æˆ·è´¦æˆ·å¹¶åœ¨ç”¨æˆ·èµ„æ–™ä¸­æ˜¾ç¤ºã€‚

## ğŸ”§ æŠ€æœ¯å®ç°

### åç«¯å®ç°
- **æ¥å£è·¯å¾„**: `POST /api/upload/avatar`
- **æ–‡ä»¶å­˜å‚¨**: æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ (`./uploads/avatars/`)
- **æ•°æ®åº“**: ç”¨æˆ·è¡¨æ–°å¢ `avatar` å­—æ®µå­˜å‚¨å¤´åƒURL
- **æƒé™éªŒè¯**: éœ€è¦JWTè®¤è¯

### å‰ç«¯é›†æˆ
- **å¯è§†åŒ–æµ‹è¯•å·¥å…·**: `frontend-test.html`
- **å®æ—¶é¢„è§ˆ**: é€‰æ‹©æ–‡ä»¶åç«‹å³æ˜¾ç¤ºé¢„è§ˆ
- **è‡ªåŠ¨æ›´æ–°**: ä¸Šä¼ æˆåŠŸåè‡ªåŠ¨åˆ·æ–°ç”¨æˆ·èµ„æ–™

## ğŸ“‹ ä½¿ç”¨æ–¹æ³•

### 1. å‰ç«¯åŒå­¦ä½¿ç”¨å¯è§†åŒ–å·¥å…·
1. æ‰“å¼€ `frontend-test.html` æ–‡ä»¶
2. ç‚¹å‡»"å¿«é€Ÿç™»å½•æµ‹è¯•è´¦å·"
3. åœ¨"å¤´åƒä¸Šä¼ "åŒºåŸŸé€‰æ‹©å›¾ç‰‡æ–‡ä»¶
4. ç‚¹å‡»"ä¸Šä¼ å¤´åƒ"æŒ‰é’®
5. æŸ¥çœ‹ä¸Šä¼ ç»“æœå’Œç”¨æˆ·èµ„æ–™æ›´æ–°

### 2. JavaScript ä»£ç é›†æˆ
```javascript
async function uploadAvatar(file) {
  const formData = new FormData();
  formData.append('avatar', file);

  const response = await fetch('http://106.52.165.122:8080/api/upload/avatar', {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    },
    body: formData
  });

  const result = await response.json();
  if (result.code === 200) {
    console.log('å¤´åƒä¸Šä¼ æˆåŠŸ:', result.data.avatarUrl);
    return result.data.avatarUrl;
  } else {
    console.error('ä¸Šä¼ å¤±è´¥:', result.message);
    throw new Error(result.message);
  }
}
```

## ğŸ” æ¥å£è¯¦æƒ…

### è¯·æ±‚è¦æ±‚
- **è®¤è¯**: éœ€è¦JWT Token
- **Content-Type**: `multipart/form-data`
- **æ–‡ä»¶å­—æ®µå**: `avatar`

### æ–‡ä»¶é™åˆ¶
- **æ”¯æŒæ ¼å¼**: jpg, jpeg, png, gif, webp
- **æ–‡ä»¶å¤§å°**: æœ€å¤§ 5MB
- **æ¨èå°ºå¯¸**: æ­£æ–¹å½¢å›¾ç‰‡

### å“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "å¤´åƒä¸Šä¼ æˆåŠŸ",
  "data": {
    "avatarUrl": "http://106.52.165.122:8080/uploads/avatars/1_20231214150000_uuid.jpg",
    "userId": 1
  }
}
```

### é”™è¯¯å“åº”
```json
{
  "code": 400,
  "message": "å¤´åƒæ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œæ”¯æŒæ ¼å¼ï¼šjpg, jpeg, png, gif, webp"
}
```

## ğŸ“ æ–‡ä»¶å­˜å‚¨ç»“æ„

```
workspace/
â”œâ”€â”€ uploads/           # ä¸Šä¼ æ–‡ä»¶æ ¹ç›®å½•
â”‚   â””â”€â”€ avatars/       # å¤´åƒå­˜å‚¨ç›®å½•
â”‚       â”œâ”€â”€ 1_20231214150000_uuid.jpg
â”‚       â”œâ”€â”€ 2_20231214150100_uuid.png
â”‚       â””â”€â”€ ...
```

### æ–‡ä»¶å‘½åè§„åˆ™
```
{ç”¨æˆ·ID}_{æ—¶é—´æˆ³}_{UUID}.{æ‰©å±•å}
ä¾‹å¦‚: 1_20231214150000_a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6.jpg
```

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### 1. æ­£å¸¸ä¸Šä¼ æµ‹è¯•
- âœ… æ”¯æŒçš„å›¾ç‰‡æ ¼å¼
- âœ… æ–‡ä»¶å¤§å°é™åˆ¶
- âœ… æƒé™éªŒè¯
- âœ… æ•°æ®åº“æ›´æ–°

### 2. å¼‚å¸¸æƒ…å†µæµ‹è¯•
- âŒ ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
- âŒ æ–‡ä»¶è¿‡å¤§
- âŒ æœªè®¤è¯è¯·æ±‚
- âŒ ç©ºæ–‡ä»¶

### 3. è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œå¤´åƒä¸Šä¼ ç›¸å…³æµ‹è¯•
go test ./tests/ -run TestUploadAvatar -v

# è¿è¡Œæ‰€æœ‰ä¸Šä¼ æµ‹è¯•
go test ./tests/ -run TestUpload -v
```

## ğŸ”„ APIæ›´æ–°

### ç”¨æˆ·èµ„æ–™æ¥å£å˜æ›´
è·å–ç”¨æˆ·èµ„æ–™æ¥å£ç°åœ¨åŒ…å« `avatar` å­—æ®µï¼š

```json
{
  "code": 200,
  "data": {
    "userId": 1,
    "username": "Yw166332",
    "phone": "17875242005",
    "avatar": "http://106.52.165.122:8080/uploads/avatars/1_20231214150000_uuid.jpg",
    "status": 1,
    "createdAt": "2023-12-14T15:00:00Z",
    "updatedAt": "2023-12-14T15:00:00Z"
  }
}
```

## ğŸš€ éƒ¨ç½²è¯´æ˜

### 1. åˆ›å»ºä¸Šä¼ ç›®å½•
æœåŠ¡å™¨éœ€è¦åˆ›å»ºä¸Šä¼ ç›®å½•ï¼š
```bash
mkdir -p /workspace/uploads/avatars
chmod 755 /workspace/uploads/avatars
```

### 2. é…ç½®é™æ€æ–‡ä»¶è®¿é—®
Ginè·¯ç”±å·²é…ç½®é™æ€æ–‡ä»¶æœåŠ¡ï¼š
```go
router.Static("/uploads", "./uploads")
```

### 3. æ•°æ®åº“è¿ç§»
ç”¨æˆ·è¡¨æ–°å¢ `avatar` å­—æ®µï¼Œå¯åŠ¨åº”ç”¨æ—¶è‡ªåŠ¨è¿ç§»ã€‚

## ğŸ’¡ æœ€ä½³å®è·µ

### å‰ç«¯å®ç°å»ºè®®
1. **æ–‡ä»¶é¢„è§ˆ**: é€‰æ‹©æ–‡ä»¶åç«‹å³æ˜¾ç¤ºé¢„è§ˆ
2. **æ ¼å¼éªŒè¯**: å‰ç«¯é¢„å…ˆéªŒè¯æ–‡ä»¶æ ¼å¼å’Œå¤§å°
3. **ä¸Šä¼ è¿›åº¦**: æ˜¾ç¤ºä¸Šä¼ è¿›åº¦æŒ‡ç¤ºå™¨
4. **é”™è¯¯å¤„ç†**: å‹å¥½çš„é”™è¯¯æç¤ºä¿¡æ¯
5. **åŠ è½½çŠ¶æ€**: ä¸Šä¼ è¿‡ç¨‹ä¸­ç¦ç”¨æŒ‰é’®æ˜¾ç¤ºåŠ è½½

### åç«¯ä¼˜åŒ–å»ºè®®
1. **å›¾ç‰‡å‹ç¼©**: å¯ä»¥è€ƒè™‘è‡ªåŠ¨å‹ç¼©å¤§å›¾ç‰‡
2. **äº‘å­˜å‚¨**: ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨äº‘å­˜å‚¨æœåŠ¡
3. **ç¼“å­˜**: å¯ä»¥å¯¹å¤´åƒè¿›è¡Œç¼“å­˜ä¼˜åŒ–
4. **å®‰å…¨**: éªŒè¯æ–‡ä»¶å†…å®¹ï¼Œé˜²æ­¢æ¶æ„æ–‡ä»¶ä¸Šä¼ 

## ğŸ› å¸¸è§é—®é¢˜

### Q: ä¸Šä¼ å¤±è´¥æç¤º"æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ"
A: æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸º jpg, jpeg, png, gif, webp æ ¼å¼

### Q: ä¸Šä¼ å¤±è´¥æç¤º"æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB"
A: å‹ç¼©å›¾ç‰‡æˆ–é€‰æ‹©æ›´å°çš„æ–‡ä»¶

### Q: å¤´åƒä¸Šä¼ æˆåŠŸä½†ç”¨æˆ·èµ„æ–™ä¸­çœ‹ä¸åˆ°
A: æ£€æŸ¥å‰ç«¯æ˜¯å¦æ­£ç¡®åˆ·æ–°ç”¨æˆ·èµ„æ–™ä¿¡æ¯

### Q: è®¿é—®å¤´åƒURLè¿”å›404
A: ç¡®è®¤æœåŠ¡å™¨å·²å¯åŠ¨ä¸”é™æ€æ–‡ä»¶æœåŠ¡é…ç½®æ­£ç¡®

---

**ğŸ“ å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ `frontend-test.html` å¯è§†åŒ–æµ‹è¯•å·¥å…·æˆ–è”ç³»åç«¯å¼€å‘äººå‘˜**